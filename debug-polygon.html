<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ë³´ë¼ìƒ‰ í´ë¦¬ê³¤ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial; }
        #map { width: 800px; height: 600px; border: 2px solid #ccc; }
        .debug-info { margin: 20px 0; padding: 15px; background: #f0f0f0; border-radius: 8px; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ” ë³´ë¼ìƒ‰ í´ë¦¬ê³¤ ë³µì› ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="debug-info">
        <h3>í…ŒìŠ¤íŠ¸ ì ˆì°¨:</h3>
        <p>1. ì§€ë„ê°€ ë¡œë“œë˜ë©´ "í´ë¦¬ê³¤ ìƒì„± í…ŒìŠ¤íŠ¸" ë²„íŠ¼ í´ë¦­</p>
        <p>2. ë³´ë¼ìƒ‰ í´ë¦¬ê³¤ì´ ë‚˜íƒ€ë‚˜ëŠ”ì§€ í™•ì¸</p>
        <p>3. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ ë³µì› í™•ì¸</p>
    </div>

    <button class="button" onclick="createTestPolygon()">í´ë¦¬ê³¤ ìƒì„± í…ŒìŠ¤íŠ¸</button>
    <button class="button" onclick="clearPolygons()">í´ë¦¬ê³¤ ì§€ìš°ê¸°</button>
    <button class="button" onclick="checkSessionStorage()">sessionStorage í™•ì¸</button>
    
    <div id="map"></div>
    <div id="debug-log" class="debug-info"></div>

    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=xzbnwd2h1z"></script>
    <script>
        let map;
        let testPolygon;
        
        // ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜
        function debugLog(message) {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(message);
        }
        
        // ì§€ë„ ì´ˆê¸°í™”
        map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(37.56404135733639, 126.97949142849764), // ì†Œê³µë™ 87-1 ìœ„ì¹˜
            zoom: 19
        });
        
        debugLog('ğŸ—ºï¸ ë„¤ì´ë²„ ì§€ë„ ë¡œë“œ ì™„ë£Œ');
        
        // í…ŒìŠ¤íŠ¸ í´ë¦¬ê³¤ ìƒì„± í•¨ìˆ˜
        function createTestPolygon() {
            debugLog('ğŸ¯ í…ŒìŠ¤íŠ¸ í´ë¦¬ê³¤ ìƒì„± ì‹œì‘...');
            
            // ì‹¤ì œ ì†Œê³µë™ 87-1 ì¢Œí‘œ ë°ì´í„°
            const coords = [
                [126.97949142849764,37.56404135733639],
                [126.97950645745438,37.56404838785255],
                [126.97940522541276,37.56415983027095],
                [126.9792968038194,37.56427784846614],
                [126.9793491663617,37.564306608863824],
                [126.97938634065025,37.564560712708165],
                [126.9794353377243,37.56460325756411],
                [126.97947435588326,37.56463200639821],
                [126.97950628126367,37.56464723906524],
                [126.97952335917545,37.56465372936725],
                [126.97953810727759,37.56465400241038],
                [126.97954623712707,37.56464355245354],
                [126.97958739655046,37.564665553242484],
                [126.9796135409662,37.56467114422635],
                [126.9796267954074,37.564670065498085],
                [126.97963771870954,37.56466727445762],
                [126.97964780593303,37.564659347625195],
                [126.9796574184852,37.5646489790243],
                [126.97966255996154,37.564639339395995],
                [126.9796680748461,37.564630060232105],
                [126.979695328061,37.56463709298517]
            ];
            
            // ë„¤ì´ë²„ ì¢Œí‘œë¡œ ë³€í™˜
            const naverCoords = coords.map(coord => new naver.maps.LatLng(coord[1], coord[0]));
            debugLog(`ğŸ”„ ì¢Œí‘œ ${coords.length}ê°œ ë³€í™˜ ì™„ë£Œ`);
            
            // ê¸°ì¡´ í´ë¦¬ê³¤ ì œê±°
            if (testPolygon) {
                testPolygon.setMap(null);
                debugLog('ğŸ—‘ï¸ ê¸°ì¡´ í´ë¦¬ê³¤ ì œê±°');
            }
            
            // ë³´ë¼ìƒ‰ í´ë¦¬ê³¤ ìƒì„±
            testPolygon = new naver.maps.Polygon({
                map: map,
                paths: naverCoords,
                fillColor: '#9370DB',
                fillOpacity: 0.9,
                strokeColor: '#6A0DAD',
                strokeOpacity: 1,
                strokeWeight: 3
            });
            
            debugLog('ğŸŸ£ ë³´ë¼ìƒ‰ í´ë¦¬ê³¤ ìƒì„± ì™„ë£Œ');
            debugLog(`   - fillColor: #9370DB`);
            debugLog(`   - fillOpacity: 0.9`);
            debugLog(`   - strokeColor: #6A0DAD`);
            debugLog(`   - strokeWeight: 3`);
            
            // sessionStorageì— ì €ì¥
            const sessionData = {
                "1114011100100870001": {
                    data: {
                        type: "Feature",
                        geometry: {
                            type: "MultiPolygon",
                            coordinates: [[coords]]
                        },
                        properties: {
                            pnu: "1114011100100870001",
                            jibun: "87-1ëŒ€",
                            addr: "ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì†Œê³µë™ 87-1"
                        }
                    },
                    geometry: {
                        type: "MultiPolygon",
                        coordinates: [[coords]]
                    },
                    properties: {
                        pnu: "1114011100100870001",
                        jibun: "87-1ëŒ€"
                    },
                    displayText: "ì†Œê³µë™ 87-1",
                    timestamp: Date.now()
                }
            };
            
            sessionStorage.setItem('searchParcels', JSON.stringify(sessionData));
            debugLog('ğŸ’¾ sessionStorageì— ë°ì´í„° ì €ì¥ ì™„ë£Œ');
        }
        
        // í´ë¦¬ê³¤ ì§€ìš°ê¸°
        function clearPolygons() {
            if (testPolygon) {
                testPolygon.setMap(null);
                testPolygon = null;
                debugLog('ğŸ—‘ï¸ ëª¨ë“  í´ë¦¬ê³¤ ì œê±°');
            }
        }
        
        // sessionStorage í™•ì¸
        function checkSessionStorage() {
            const data = sessionStorage.getItem('searchParcels');
            if (data) {
                const parsed = JSON.parse(data);
                debugLog('ğŸ’¾ sessionStorage ë°ì´í„° ì¡´ì¬:');
                debugLog(`   - í‚¤ ê°œìˆ˜: ${Object.keys(parsed).length}`);
                Object.keys(parsed).forEach(key => {
                    debugLog(`   - ${key}: ${parsed[key].displayText || 'ë¼ë²¨ì—†ìŒ'}`);
                });
            } else {
                debugLog('ğŸ’¾ sessionStorage ë°ì´í„° ì—†ìŒ');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë³µì› í…ŒìŠ¤íŠ¸
        window.addEventListener('load', function() {
            debugLog('ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ë³µì› í…ŒìŠ¤íŠ¸ ì‹œì‘');
            checkSessionStorage();
        });
    </script>
</body>
</html>