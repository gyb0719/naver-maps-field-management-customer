<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#667eea">
    <title>NAVER Maps Field Management Program</title>
    
    <!-- ÎÑ§Ïù¥Î≤Ñ ÏßÄÎèÑ API -->
    <!-- üéØ Í≥†Í∞ùÏö© ÏÑ§Ï†ï - Ïã§Ï†ú ÎÑ§Ïù¥Î≤Ñ ÏßÄÎèÑ API ÌÇ§Î°ú ÍµêÏ≤¥ÌïòÏÑ∏Ïöî -->
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=YOUR_NAVER_MAPS_CLIENT_ID&submodules=geocoder,panorama"></script>
    
    <!-- Google Identity Services - ÏûÑÏãú ÎπÑÌôúÏÑ±Ìôî -->
    <!-- <script src="https://accounts.google.com/gsi/client" async defer></script> -->
    
    <!-- CSS -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/advanced-ui.css">
    <link rel="stylesheet" href="/css/business-style.css">
    <link rel="stylesheet" href="/css/responsive.css">
</head>
<body>
    <div id="app">
        <!-- Ìó§Îçî ÏòÅÏó≠ -->
        <header class="header">
            <h1 style="color: white;">ÎÑ§Ïù¥Î≤Ñ ÏßÄÎèÑ ÌïÑÏßÄ Í¥ÄÎ¶¨ ÌîÑÎ°úÍ∑∏Îû®</h1>
            <div class="header-controls">
                <!-- ÏßÄÎèÑ ÌÉÄÏûÖ ÏÑ†ÌÉù -->
                <div class="map-type-selector">
                    <button class="map-type-btn active" data-type="normal">ÏùºÎ∞òÏßÄÎèÑ</button>
                    <button class="map-type-btn" data-type="satellite">ÏúÑÏÑ±ÏßÄÎèÑ</button>
                    <button class="map-type-btn" data-type="cadastral">ÏßÄÏ†ÅÌé∏ÏßëÎèÑ</button>
                    <button class="map-type-btn" data-type="street">Í±∞Î¶¨Î∑∞</button>
                </div>
                
                <!-- Í≤ÄÏÉâ -->
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="ÏßÄÎ≤à ÎòêÎäî Ï£ºÏÜå Í≤ÄÏÉâ">
                    <button id="searchBtn">Í≤ÄÏÉâ</button>
                    <button id="searchToggleBtn" class="search-toggle-btn" title="Í≤ÄÏÉâ Î™®Îìú on/off">
                        Í≤ÄÏÉâ OFF
                    </button>
                </div>
                
                <!-- Ï∫òÎ¶∞Îçî Î≤ÑÌäº -->
                <button id="calendarBtn" class="header-calendar-btn" onclick="openCalendarModal()" title="ÏóÖÎ¨¥ Ï∫òÎ¶∞Îçî">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                        <line x1="3" y1="9" x2="21" y2="9" stroke="currentColor" stroke-width="2"/>
                        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <rect x="7" y="12" width="3" height="3" rx="0.5" fill="currentColor"/>
                        <rect x="14" y="12" width="3" height="3" rx="0.5" fill="currentColor"/>
                        <rect x="7" y="17" width="3" height="3" rx="0.5" fill="currentColor"/>
                    </svg>
                    <span>Ï∫òÎ¶∞Îçî</span>
                </button>

                <!-- Î∞±ÏóÖ Í¥ÄÎ¶¨ Î≤ÑÌäº -->
                <button id="backupToggleBtn" class="header-backup-btn" title="Î∞±ÏóÖ Í¥ÄÎ¶¨">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Î∞±ÏóÖ</span>
                    <div id="connectionIndicator" class="connection-indicator">
                        <span class="status-dot connecting"></span>
                    </div>
                </button>
                
            </div>
        </header>

        <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
        <div class="main-container">
            <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
            <aside class="sidebar">
            <!-- ÏÉâÏÉÅ ÏÑ†ÌÉù Ìå®ÎÑê -->
            <div class="color-panel">
                <div class="panel-header">
                    <h3>ÌïÑÏßÄ ÏÉâÏÉÅ</h3>
                    <!-- üéØ ULTRATHINK: ÌïÑÏßÄ ÏÉâÏπ† on/off Î≤ÑÌäº -->
                    <button id="paintToggleBtn" class="paint-toggle-btn active" title="ÌïÑÏßÄ ÏÉâÏπ† Î™®Îìú ÌÜ†Í∏Ä">
                        <span class="toggle-icon">üé®</span>
                        <span class="toggle-text">ÏÉâÏπ† ON</span>
                    </button>
                </div>
                <div class="color-palette">
                    <div class="color-item active" data-color="#FF0000" style="background: #FF0000"></div>
                    <div class="color-item" data-color="#FFA500" style="background: #FFA500"></div>
                    <div class="color-item" data-color="#FFFF00" style="background: #FFFF00"></div>
                    <div class="color-item" data-color="#90EE90" style="background: #90EE90"></div>
                    <div class="color-item" data-color="#0000FF" style="background: #0000FF"></div>
                    <div class="color-item" data-color="#000000" style="background: #000000"></div>
                    <div class="color-item" data-color="#FFFFFF" style="background: #FFFFFF; border: 1px solid #ccc"></div>
                    <div class="color-item" data-color="#87CEEB" style="background: #87CEEB"></div>
                </div>
                <div class="current-color">
                    <span>ÏÑ†ÌÉùÎêú ÏÉâÏÉÅ:</span>
                    <div id="currentColor" style="background: #FF0000"></div>
                </div>
                <!-- Ï¥àÍ∏∞Ìôî Î≤ÑÌäºÎì§ Ï†úÍ±∞ - Ïö∞ÌÅ¥Î¶≠Ïù¥ Ïú†ÏùºÌïú ÏÇ≠Ï†ú Î∞©Î≤ï -->
            </div>

            <!-- ÌïÑÏßÄ Ï†ïÎ≥¥ ÏûÖÎ†• -->
            <div class="parcel-info">
                <h3>ÌïÑÏßÄ Ï†ïÎ≥¥</h3>
                <form id="parcelForm">
                    <div class="form-group">
                        <label>ÏßÄÎ≤à</label>
                        <input type="text" id="parcelNumber" placeholder="Ïòà: 123-4">
                    </div>
                    <div class="form-group">
                        <label>ÏÜåÏú†Ïûê Ïù¥Î¶Ñ</label>
                        <input type="text" id="ownerName" placeholder="ÌôçÍ∏∏Îèô">
                    </div>
                    <div class="form-group">
                        <label>ÏÜåÏú†Ïûê Ï£ºÏÜå</label>
                        <input type="text" id="ownerAddress" placeholder="ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨...">
                    </div>
                    <div class="form-group">
                        <label>Ïó∞ÎùΩÏ≤ò</label>
                        <input type="text" id="ownerContact" placeholder="010-1234-5678">
                    </div>
                    <div class="form-group">
                        <label>Î©îÎ™®</label>
                        <textarea id="memo" rows="3" placeholder="Ï∂îÍ∞Ä Î©îÎ™®..." style="resize: vertical; min-height: 60px;"></textarea>
                    </div>
                    <div class="form-buttons">
                        <button type="button" id="saveBtn">Ï†ÄÏû•</button>
                        <!-- Ï¥àÍ∏∞Ìôî Î≤ÑÌäº Ï†úÍ±∞ - Ïö∞ÌÅ¥Î¶≠Ïù¥ Ïú†ÏùºÌïú ÏÇ≠Ï†ú Î∞©Î≤ï -->
                    </div>
                    <div class="export-buttons">
                        <button type="button" id="exportCurrentBtn" onclick="exportCurrentParcelToGoogleSheets()">
                            Íµ¨Í∏Ä ÏãúÌä∏ Ï†ÑÏÜ°
                        </button>
                        <button type="button" id="copyDataBtn" onclick="copyDataToClipboard()">
                            ÏóëÏÖÄ Î≥µÏÇ¨
                        </button>
                    </div>
                </form>
            </div>


            </aside>

            <!-- ÏßÄÎèÑ ÏòÅÏó≠ -->
            <div class="map-container">
                <div id="map"></div>
                <div id="pano" style="display:none;"></div>
                
                <!-- ÌîåÎ°úÌåÖ Î∞±ÏóÖ Ìå®ÎÑê -->
                <div id="floatingBackupPanel" class="floating-backup-panel" style="display:none;">
                    <div class="backup-panel-header">
                        <h3>üíæ Î∞±ÏóÖ Í¥ÄÎ¶¨</h3>
                        <button class="close-btn" onclick="toggleBackupPanel()">&times;</button>
                    </div>
                    <div class="backup-panel-content">
                        <div class="backup-status-mini">
                            <div class="status-row">
                                <span class="status-label">Ïó∞Í≤∞:</span>
                                <div id="connectionStatus" class="status-indicator">
                                    <span class="status-dot connecting"></span>
                                    <span class="status-text">ÌôïÏù∏ Ï§ë...</span>
                                </div>
                            </div>
                            <div class="status-row">
                                <span class="status-label">Î∞±ÏóÖ:</span>
                                <span id="lastBackupTime">ÌôïÏù∏ Ï§ë...</span>
                            </div>
                        </div>
                        <div class="backup-actions-mini">
                            <button type="button" id="manualBackupBtn" class="backup-btn-mini primary">
                                üìÅ ÏàòÎèô Î∞±ÏóÖ
                            </button>
                            <button type="button" id="backupHistoryBtn" class="backup-btn-mini secondary">
                                üìã Î∞±ÏóÖ Î™©Î°ù
                            </button>
                            <button type="button" id="restoreBtn" class="backup-btn-mini warning">
                                üîÑ Î≥µÏõêÌïòÍ∏∞
                            </button>
                            <button type="button" id="backupPageBtn" class="backup-btn-mini info" onclick="window.open('/backup.html', '_blank')">
                                ‚öôÔ∏è Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- üéØ ULTRATHINK: Í±∞Î¶¨Î∑∞ÏóêÏÑú ÏßÄÎèÑÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞ Î≤ÑÌäº -->
                <div id="streetViewControls" class="street-controls" style="display:none;">
                    <button id="backToMapBtn" class="back-to-map-btn">
                        <span>üó∫Ô∏è</span>
                        <span class="back-text">ÏßÄÎèÑÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</span>
                    </button>
                </div>
                
                <!-- üéØ ULTRATHINK: Í±∞Î¶¨Î∑∞ Ïª§Ïä§ÌÖÄ ÎØ∏ÎãàÎßµ -->
                <div id="panoramaMinimap" class="panorama-minimap" style="display:none;">
                    <div id="minimapContainer"></div>
                    <div class="minimap-header">
                        <span>üó∫Ô∏è</span>
                        <span>ÎØ∏ÎãàÎßµ</span>
                        <button id="minimapToggle" class="minimap-toggle">‚àí</button>
                    </div>
                </div>
                
                <!-- üéØ ULTRATHINK: Í±∞Î¶¨Î∑∞ ÌôîÏÇ¥Ìëú ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
                <div id="panoramaNavigation" class="panorama-nav" style="display:none;">
                    <button id="navUpBtn" class="nav-btn nav-up">‚ñ≤</button>
                    <div class="nav-horizontal">
                        <button id="navLeftBtn" class="nav-btn nav-left">‚óÄ</button>
                        <button id="navRightBtn" class="nav-btn nav-right">‚ñ∂</button>
                    </div>
                    <button id="navDownBtn" class="nav-btn nav-down">‚ñº</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Î™®Îã¨ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>
    
    <!-- Ï∫òÎ¶∞Îçî Î™®Îã¨ -->
    <div id="calendarModal" class="modal" style="display: none;">
        <div class="modal-content calendar-modal">
            <div class="modal-header">
                <h2>ÏóÖÎ¨¥ Ï∫òÎ¶∞Îçî</h2>
                <span class="close" onclick="closeCalendarModal()">&times;</span>
            </div>
            <div class="modal-body">
                <iframe id="calendarIframe" 
                        src="https://calendar.google.com/calendar/embed?height=600&wkst=2&bgcolor=%23ffffff&ctz=Asia%2FSeoul&showTitle=0&showNav=1&showDate=1&showPrint=0&showTabs=1&showCalendars=1&showTz=0&mode=MONTH&src=ko.south_korea%23holiday%40group.v.calendar.google.com&color=%230B8043" 
                        style="border: 0; width: 100%; height: 500px;" 
                        frameborder="0" 
                        scrolling="yes">
                </iframe>
            </div>
            <div class="modal-footer">
                <input type="text" id="calendarUrl" placeholder="Íµ¨Í∏Ä Ï∫òÎ¶∞Îçî URL ÎòêÎäî Ïù¥Î©îÏùº">
                <button onclick="updateCalendar()" class="btn-primary">Ï†ÅÏö©</button>
                <button onclick="closeCalendarModal()" class="btn-secondary">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
    

    <!-- JavaScript -->
    <script>
        // ÎîîÎ≤ÑÍπÖÏö©
        window.addEventListener('load', function() {
            console.log('window load event');
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded event');
        });

        // Î∞±ÏóÖ Ìå®ÎÑê ÌÜ†Í∏Ä Ìï®Ïàò
        function toggleBackupPanel() {
            const panel = document.getElementById('floatingBackupPanel');
            const isVisible = panel.style.display !== 'none';
            
            if (isVisible) {
                panel.style.display = 'none';
            } else {
                panel.style.display = 'block';
            }
        }

        // Ìó§Îçî Î∞±ÏóÖ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        document.addEventListener('DOMContentLoaded', function() {
            const backupToggleBtn = document.getElementById('backupToggleBtn');
            if (backupToggleBtn) {
                backupToggleBtn.addEventListener('click', toggleBackupPanel);
            }
        });
    </script>
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- üéØ SUPABASE Ï†ÑÏö© ÏãúÏä§ÌÖú: localStorage ÏôÑÏ†Ñ Ï†úÍ±∞, ÌÅ¥ÎùºÏö∞Îìú Ï†ÄÏû•ÏÜåÎßå ÏÇ¨Ïö© -->
    <script src="/js/app-core.js"></script>
    <script src="/js/config-client.js"></script>
    <script src="/js/config.js"></script>
    <script src="/js/rate-limiter.js"></script>
    <script src="/js/virtual-scroller.js"></script>
    <script src="/js/viewport-renderer.js"></script>
    <script src="/js/indexeddb-cache.js"></script>
    <!-- Supabase Ï†ÑÏö© Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú -->
    <script src="/js/supabase-manager.js"></script>
    <script src="/js/backup-manager.js"></script>
    <script src="/js/data-manager-supabase.js"></script>
    <!-- Í∏∞Ï°¥ ÏãúÏä§ÌÖú Ìò∏ÌôòÏÑ± Ïú†ÏßÄ -->
    <script src="/js/data-manager-realtime.js"></script>
    <script src="/js/user-manager.js"></script>
    <script src="/js/realtime-ui.js"></script>
    <script src="/js/sync-status.js"></script>
    <!-- <script src="/js/auth.js"></script> --> <!-- ÏûÑÏãú ÎπÑÌôúÏÑ±Ìôî -->
    <script src="/js/utils.js"></script>
    <script src="/js/calendar.js"></script>
    <script src="/js/map.js"></script>
    <script src="/js/map-init.js"></script>
    <script src="/js/parcel.js"></script>
    <script src="/js/parcel-manager.js"></script>
    <script src="/js/search.js"></script>
    <script src="/js/sheets.js"></script>
    <script src="/js/backup-ui.js"></script>
    <script src="/js/migration-helper.js"></script>
    <script src="/js/mobile-handler.js"></script>
</body>
</html>