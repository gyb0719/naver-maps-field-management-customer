<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í´ë¦¬ê³¤ í…ŒìŠ¤íŠ¸</title>
    <!-- ë„¤ì´ë²„ ì§€ë„ API -->
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=xzbnwd2h1z&submodules=geocoder,panorama"></script>
    <style>
        #map { width: 100%; height: 600px; }
        .controls { margin: 10px; }
        .log { margin: 10px; padding: 10px; background: #f5f5f5; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="controls">
        <h2>í´ë¦¬ê³¤ ë Œë”ë§ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testPolygon()">í…ŒìŠ¤íŠ¸ í´ë¦¬ê³¤ ê·¸ë¦¬ê¸°</button>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>
    
    <div id="map"></div>
    
    <div class="log" id="log"></div>

    <script>
        let map;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // ì§€ë„ ì´ˆê¸°í™”
        function initMap() {
            log('ğŸ—ºï¸ ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
            
            const mapOptions = {
                center: new naver.maps.LatLng(37.5666, 126.9784), // ì„œìš¸ì‹œì²­
                zoom: 18,
                mapTypeId: naver.maps.MapTypeId.NORMAL
            };
            
            map = new naver.maps.Map('map', mapOptions);
            log('âœ… ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ');
            
            // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
            naver.maps.Event.addListener(map, 'click', function(e) {
                const coord = e.coord;
                log(`ğŸ–±ï¸ ì§€ë„ í´ë¦­: ${coord.lat().toFixed(6)}, ${coord.lng().toFixed(6)}`);
            });
        }
        
        // í…ŒìŠ¤íŠ¸ í´ë¦¬ê³¤ ê·¸ë¦¬ê¸°
        function testPolygon() {
            log('ğŸ¨ í…ŒìŠ¤íŠ¸ í´ë¦¬ê³¤ ê·¸ë¦¬ê¸° ì‹œì‘');
            
            if (!map) {
                log('âŒ ì§€ë„ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ì„œìš¸ì‹œì²­ ì£¼ë³€ ì‚¬ê°í˜• í´ë¦¬ê³¤ (ë” í° í¬ê¸°ë¡œ)
            const center = map.getCenter();
            const lat = center.lat();
            const lng = center.lng();
            const offset = 0.002; // ì•½ 200m
            
            const paths = [
                new naver.maps.LatLng(lat + offset, lng - offset),
                new naver.maps.LatLng(lat + offset, lng + offset),
                new naver.maps.LatLng(lat - offset, lng + offset),
                new naver.maps.LatLng(lat - offset, lng - offset),
                new naver.maps.LatLng(lat + offset, lng - offset)
            ];
            
            log(`ğŸ“ í´ë¦¬ê³¤ ê²½ë¡œ ì  ê°œìˆ˜: ${paths.length}`);
            log(`ğŸ“ ì¤‘ì‹¬ì : ${lat.toFixed(6)}, ${lng.toFixed(6)}`);
            log(`ğŸ“ ì²« ë²ˆì§¸ ì : ${paths[0].lat().toFixed(6)}, ${paths[0].lng().toFixed(6)}`);
            
            try {
                const polygon = new naver.maps.Polygon({
                    map: map,
                    paths: paths,
                    fillColor: '#FF0000',
                    fillOpacity: 0.7,
                    strokeColor: '#0000FF',
                    strokeOpacity: 1.0,
                    strokeWeight: 3,
                    clickable: true,
                    zIndex: 1000
                });
                
                log('âœ… í´ë¦¬ê³¤ ê°ì²´ ìƒì„± ì™„ë£Œ');
                
                // í´ë¦¬ê³¤ ì†ì„± í™•ì¸
                setTimeout(() => {
                    const bounds = polygon.getBounds();
                    if (bounds) {
                        log(`ğŸ“Š í´ë¦¬ê³¤ bounds: ${bounds.toString()}`);
                        
                        // ì§€ë„ë¥¼ í´ë¦¬ê³¤ì— ë§ê²Œ ì¡°ì •
                        map.fitBounds(bounds);
                        log('ğŸ¯ ì§€ë„ë¥¼ í´ë¦¬ê³¤ì— ë§ê²Œ ì¡°ì •');
                    }
                    
                    // í´ë¦¬ê³¤ì´ ì‹¤ì œë¡œ ì§€ë„ì— í‘œì‹œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                    const mapInstance = polygon.getMap();
                    log(`ğŸ—ºï¸ í´ë¦¬ê³¤ì˜ ì§€ë„ ì¸ìŠ¤í„´ìŠ¤: ${mapInstance ? 'ìˆìŒ' : 'ì—†ìŒ'}`);
                }, 1000);
                
                // í´ë¦­ ì´ë²¤íŠ¸
                naver.maps.Event.addListener(polygon, 'click', function(e) {
                    log('ğŸ–±ï¸ í´ë¦¬ê³¤ í´ë¦­ë¨');
                    
                    // ìƒ‰ìƒ ë³€ê²½
                    const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF'];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    
                    polygon.setOptions({
                        fillColor: randomColor,
                        strokeColor: randomColor,
                        fillOpacity: 0.8,
                        strokeWeight: 5
                    });
                    
                    log(`ğŸ¨ í´ë¦¬ê³¤ ìƒ‰ìƒ ë³€ê²½: ${randomColor}`);
                });
                
                // í´ë¦¬ê³¤ ê°•ì œ ìƒˆë¡œê³ ì¹¨
                polygon.setMap(null);
                polygon.setMap(map);
                log('ğŸ”„ í´ë¦¬ê³¤ ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
                
            } catch (error) {
                log(`âŒ í´ë¦¬ê³¤ ìƒì„± ì‹¤íŒ¨: ${error.message}`);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            log('ğŸ“„ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            
            if (typeof naver === 'undefined' || typeof naver.maps === 'undefined') {
                log('âŒ ë„¤ì´ë²„ ì§€ë„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }
            
            log('âœ… ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ í™•ì¸');
            initMap();
        };
    </script>
</body>
</html>