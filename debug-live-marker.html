<!DOCTYPE html>
<html>
<head>
    <title>ğŸ¯ ULTRATHINK M ë§ˆì»¤ ì‹¤ì‹œê°„ ë””ë²„ê¹…</title>
    <meta charset="utf-8">
    <style>
        body { font-family: 'Courier New', monospace; margin: 10px; background: #1e1e1e; color: #ffffff; }
        .panel { background: #2d2d30; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #3e3e42; }
        .success { color: #4ec9b0; font-weight: bold; }
        .error { color: #f44747; font-weight: bold; }
        .warning { color: #ffcc02; font-weight: bold; }
        .info { color: #569cd6; font-weight: bold; }
        button { padding: 8px 16px; margin: 3px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px; }
        .btn-primary { background: #0e639c; color: white; }
        .btn-success { background: #107c10; color: white; }
        .btn-warning { background: #ca5010; color: white; }
        .btn-danger { background: #a4262c; color: white; }
        pre { background: #1e1e1e; padding: 10px; border-radius: 4px; white-space: pre-wrap; font-size: 11px; overflow-x: auto; }
        .step { border-left: 4px solid #569cd6; padding-left: 15px; margin: 10px 0; }
        .highlight { background: #264f78; padding: 2px 4px; border-radius: 3px; }
        #console { height: 400px; overflow-y: auto; }
        .console-line { margin: 2px 0; font-size: 11px; }
        .urgent { background: #a4262c; color: white; padding: 5px; border-radius: 4px; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>ğŸ¯ ULTRATHINK M ë§ˆì»¤ ì‹¤ì‹œê°„ í•´ê²° ë„êµ¬</h1>
    
    <div class="urgent">
        <strong>âš ï¸ ì¤‘ìš”: ë¨¼ì € http://localhost:3000 ì„ ì—´ê³  í•„ì§€ë¥¼ í´ë¦­í•œ í›„ ì´ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”!</strong>
    </div>
    
    <div class="panel">
        <h3>ğŸ”¥ ULTRATHINK ê°•ë ¥ ì§„ë‹¨</h3>
        <button class="btn-danger" onclick="step1_basicMarkerTest()">1ï¸âƒ£ ê¸°ë³¸ ë§ˆì»¤ ê°•ì œ ìƒì„± í…ŒìŠ¤íŠ¸</button>
        <button class="btn-warning" onclick="step2_coordinateCheck()">2ï¸âƒ£ ì¢Œí‘œ ë° ìœ„ì¹˜ ê²€ì¦</button>
        <button class="btn-primary" onclick="step3_forceVisibleMarker()">3ï¸âƒ£ ê°•ì œ ê°€ì‹œì„± ë§ˆì»¤ ìƒì„±</button>
        <button class="btn-success" onclick="step4_ultimateMarkerTest()">4ï¸âƒ£ ê¶ê·¹ ë§ˆì»¤ í…ŒìŠ¤íŠ¸</button>
        <button class="btn-warning" onclick="step5_realTimeMonitor()">5ï¸âƒ£ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</button>
    </div>
    
    <div class="panel">
        <h3>ğŸ“Š ì‹¤ì‹œê°„ ì½˜ì†”</h3>
        <button class="btn-primary" onclick="clearConsole()">ğŸ”„ í´ë¦¬ì–´</button>
        <button class="btn-success" onclick="copyResults()">ğŸ“‹ ê²°ê³¼ ë³µì‚¬</button>
        <div id="console"></div>
    </div>
    
    <script>
        let mainWindow = null;
        let monitorInterval = null;
        let logBuffer = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'success': '#4ec9b0',
                'error': '#f44747', 
                'warning': '#ffcc02',
                'info': '#569cd6'
            };
            
            const logLine = `[${timestamp}] ${message}`;
            logBuffer.push(logLine);
            
            const console = document.getElementById('console');
            const line = document.createElement('div');
            line.className = 'console-line';
            line.style.color = colors[type] || '#ffffff';
            line.textContent = logLine;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
            
            // ë©”ì¸ í˜ì´ì§€ ì½˜ì†”ì—ë„ ì¶œë ¥
            if (mainWindow && !mainWindow.closed) {
                mainWindow.console.log(`[ULTRATHINK] ${message}`);
            }
        }
        
        function clearConsole() {
            document.getElementById('console').innerHTML = '';
            logBuffer = [];
        }
        
        function copyResults() {
            navigator.clipboard.writeText(logBuffer.join('\\n'));
            log('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }
        
        function getMainWindow() {
            if (!mainWindow || mainWindow.closed) {
                // ê¸°ì¡´ ì°½ë“¤ ì°¾ê¸°
                if (window.opener && !window.opener.closed) {
                    mainWindow = window.opener;
                } else {
                    try {
                        // ìƒˆ ì°½ì—ì„œ ë©”ì¸ í˜ì´ì§€ ì—´ê¸°
                        mainWindow = window.open('http://localhost:3000', 'mainApp', 'width=1400,height=900');
                        log('âš ï¸ ìƒˆ ì°½ì—ì„œ ë©”ì¸ í˜ì´ì§€ë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤. í•„ì§€ë¥¼ í´ë¦­í•œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.', 'warning');
                        return null;
                    } catch (error) {
                        log(`âŒ ë©”ì¸ í˜ì´ì§€ ì ‘ê·¼ ì‹¤íŒ¨: ${error.message}`, 'error');
                        return null;
                    }
                }
            }
            return mainWindow;
        }
        
        function step1_basicMarkerTest() {
            log('ğŸ”¥ 1ë‹¨ê³„: ê¸°ë³¸ ë§ˆì»¤ ê°•ì œ ìƒì„± í…ŒìŠ¤íŠ¸', 'warning');
            
            const win = getMainWindow();
            if (!win) return;
            
            setTimeout(() => {
                try {
                    if (!win.naver || !win.naver.maps) {
                        log('âŒ ë„¤ì´ë²„ ë§µìŠ¤ APIê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ', 'error');
                        return;
                    }
                    
                    if (!win.AppState || !win.AppState.map) {
                        log('âŒ AppState ë˜ëŠ” map ê°ì²´ê°€ ì—†ìŒ', 'error');
                        return;
                    }
                    
                    log('âœ… ë„¤ì´ë²„ ë§µìŠ¤ API ë° ì§€ë„ ê°ì²´ í™•ì¸', 'success');
                    
                    // ì§€ë„ ì¤‘ì‹¬ì— ê°„ë‹¨í•œ ë¹¨ê°„ ì  ë§ˆì»¤ ìƒì„±
                    const mapCenter = win.AppState.map.getCenter();
                    log(`ğŸ“ ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œ: ${mapCenter.lat()}, ${mapCenter.lng()}`, 'info');
                    
                    // ê¸°ë³¸ ë§ˆì»¤ ìƒì„± (ê°€ì¥ ë‹¨ìˆœí•œ í˜•íƒœ)
                    const testMarker = new win.naver.maps.Marker({
                        position: mapCenter,
                        map: win.AppState.map,
                        title: 'ULTRATHINK í…ŒìŠ¤íŠ¸ ë§ˆì»¤'
                    });
                    
                    log('ğŸ¯ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ë§ˆì»¤ ìƒì„± ì™„ë£Œ', 'success');
                    
                    // 5ì´ˆ í›„ ì œê±°
                    setTimeout(() => {
                        testMarker.setMap(null);
                        log('ğŸ—‘ï¸ í…ŒìŠ¤íŠ¸ ë§ˆì»¤ ì œê±°ë¨', 'info');
                        
                        // ì´ì œ ì»¤ìŠ¤í…€ M ë§ˆì»¤ í…ŒìŠ¤íŠ¸
                        step1_customMMarker(win, mapCenter);
                        
                    }, 5000);
                    
                } catch (error) {
                    log(`âŒ ê¸°ë³¸ ë§ˆì»¤ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                    log(`ìŠ¤íƒ: ${error.stack}`, 'error');
                }
            }, 1000);
        }
        
        function step1_customMMarker(win, position) {
            try {
                log('ğŸ¯ ì»¤ìŠ¤í…€ M ë§ˆì»¤ ìƒì„± í…ŒìŠ¤íŠ¸', 'warning');
                
                // ê¸°ì¡´ ë°©ì‹ê³¼ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì‹œë„
                const customMarker = new win.naver.maps.Marker({
                    position: position,
                    map: win.AppState.map,
                    icon: {
                        content: '<div style="width: 30px; height: 30px; background: #ff0000; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; border: 3px solid white; box-shadow: 0 3px 10px rgba(0,0,0,0.5); z-index: 9999 !important;">M</div>',
                        anchor: new win.naver.maps.Point(15, 15)
                    },
                    zIndex: 9999
                });
                
                log('âœ… ì»¤ìŠ¤í…€ M ë§ˆì»¤ ìƒì„± ì™„ë£Œ', 'success');
                log('ğŸ‘€ 5ì´ˆê°„ í™•ì¸ í›„ ìë™ ì œê±°ë©ë‹ˆë‹¤', 'info');
                
                // 5ì´ˆ í›„ ì œê±°
                setTimeout(() => {
                    customMarker.setMap(null);
                    log('ğŸ—‘ï¸ ì»¤ìŠ¤í…€ M ë§ˆì»¤ ì œê±°ë¨', 'info');
                }, 5000);
                
            } catch (error) {
                log(`âŒ ì»¤ìŠ¤í…€ M ë§ˆì»¤ ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }
        
        function step2_coordinateCheck() {
            log('ğŸ”¥ 2ë‹¨ê³„: ì¢Œí‘œ ë° ìœ„ì¹˜ ê²€ì¦', 'warning');
            
            const win = getMainWindow();
            if (!win) return;
            
            setTimeout(() => {
                try {
                    if (!win.AppState?.clickParcels?.size) {
                        log('âŒ í´ë¦­ëœ í•„ì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì§€ë„ë¥¼ í´ë¦­í•˜ì„¸ìš”!', 'error');
                        return;
                    }
                    
                    const parcels = Array.from(win.AppState.clickParcels.entries());
                    const [pnu, parcelData] = parcels[0];
                    
                    log(`ğŸ“‹ ê²€ì‚¬í•  í•„ì§€: ${pnu}`, 'info');
                    log(`ğŸ“ ì§€ë²ˆ: ${parcelData.data?.jibun}`, 'info');
                    
                    // ì§€ì˜¤ë©”íŠ¸ë¦¬ í™•ì¸
                    const geometry = parcelData.data?.geometry;
                    if (!geometry) {
                        log('âŒ í•„ì§€ ì§€ì˜¤ë©”íŠ¸ë¦¬ ë°ì´í„° ì—†ìŒ', 'error');
                        return;
                    }
                    
                    log(`ğŸ“ ì§€ì˜¤ë©”íŠ¸ë¦¬ íƒ€ì…: ${geometry.type}`, 'success');
                    log(`ğŸ“ ì¢Œí‘œ ìˆ˜: ${geometry.coordinates[0]?.length}`, 'info');
                    
                    // ì¢Œí‘œ ë²”ìœ„ í™•ì¸
                    const coords = geometry.coordinates[0];
                    let minLat = 90, maxLat = -90, minLng = 180, maxLng = -180;
                    
                    coords.forEach(coord => {
                        const lat = coord[1];
                        const lng = coord[0];
                        minLat = Math.min(minLat, lat);
                        maxLat = Math.max(maxLat, lat);
                        minLng = Math.min(minLng, lng);
                        maxLng = Math.max(maxLng, lng);
                    });
                    
                    const centerLat = (minLat + maxLat) / 2;
                    const centerLng = (minLng + maxLng) / 2;
                    
                    log(`ğŸ¯ ê³„ì‚°ëœ ì¤‘ì‹¬ì : ${centerLat}, ${centerLng}`, 'success');
                    log(`ğŸ“Š ì¢Œí‘œ ë²”ìœ„: lat(${minLat}~${maxLat}), lng(${minLng}~${maxLng})`, 'info');
                    
                    // í˜„ì¬ ì§€ë„ ë·° ë²”ìœ„ì™€ ë¹„êµ
                    const mapBounds = win.AppState.map.getBounds();
                    const sw = mapBounds.getSW();
                    const ne = mapBounds.getNE();
                    
                    log(`ğŸ—ºï¸ ì§€ë„ ë·° ë²”ìœ„: lat(${sw.lat()}~${ne.lat()}), lng(${sw.lng()}~${ne.lng()})`, 'info');
                    
                    // ì¤‘ì‹¬ì ì´ ì§€ë„ ë·° ì•ˆì— ìˆëŠ”ì§€ í™•ì¸
                    const inView = centerLat >= sw.lat() && centerLat <= ne.lat() && 
                                   centerLng >= sw.lng() && centerLng <= ne.lng();
                    
                    log(`ğŸ‘ï¸ ì¤‘ì‹¬ì ì´ í˜„ì¬ ë·°ì— ìˆìŒ: ${inView}`, inView ? 'success' : 'error');
                    
                    if (!inView) {
                        log('âš ï¸ í•„ì§€ê°€ í˜„ì¬ í™”ë©´ ë°–ì— ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'warning');
                        
                        // í•´ë‹¹ ì¢Œí‘œë¡œ ì§€ë„ ì´ë™
                        win.AppState.map.setCenter(new win.naver.maps.LatLng(centerLat, centerLng));
                        log('ğŸ“ í•´ë‹¹ ì¢Œí‘œë¡œ ì§€ë„ë¥¼ ì´ë™í–ˆìŠµë‹ˆë‹¤', 'success');
                    }
                    
                } catch (error) {
                    log(`âŒ ì¢Œí‘œ ê²€ì¦ ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }, 1000);
        }
        
        function step3_forceVisibleMarker() {
            log('ğŸ”¥ 3ë‹¨ê³„: ê°•ì œ ê°€ì‹œì„± ë§ˆì»¤ ìƒì„±', 'warning');
            
            const win = getMainWindow();
            if (!win) return;
            
            setTimeout(() => {
                try {
                    if (!win.AppState?.clickParcels?.size) {
                        log('âŒ í´ë¦­ëœ í•„ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!', 'error');
                        return;
                    }
                    
                    const parcels = Array.from(win.AppState.clickParcels.entries());
                    const [pnu, parcelData] = parcels[0];
                    const geometry = parcelData.data?.geometry;
                    
                    if (!geometry) {
                        log('âŒ ì§€ì˜¤ë©”íŠ¸ë¦¬ ì—†ìŒ', 'error');
                        return;
                    }
                    
                    // ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ë¡œ ë§ˆì»¤ ìƒì„± ì‹œë„
                    const coords = geometry.coordinates[0];
                    let centerLat = 0, centerLng = 0;
                    coords.forEach(coord => {
                        centerLat += coord[1];
                        centerLng += coord[0];
                    });
                    centerLat /= coords.length;
                    centerLng /= coords.length;
                    
                    const position = new win.naver.maps.LatLng(centerLat, centerLng);
                    
                    // ë°©ë²• 1: ë§¤ìš° í° ë¹¨ê°„ ì›
                    const bigMarker = new win.naver.maps.Marker({
                        position: position,
                        map: win.AppState.map,
                        icon: {
                            content: '<div style="width: 50px; height: 50px; background: #ff0000; border-radius: 50%; border: 5px solid white; box-shadow: 0 0 20px rgba(255,0,0,0.8); z-index: 999999 !important; position: absolute !important;"></div>',
                            anchor: new win.naver.maps.Point(25, 25)
                        },
                        zIndex: 999999
                    });
                    
                    log('ğŸ”´ ë°©ë²• 1: í° ë¹¨ê°„ ì› ë§ˆì»¤ ìƒì„±', 'success');
                    
                    setTimeout(() => {
                        bigMarker.setMap(null);
                        
                        // ë°©ë²• 2: HTML í…ìŠ¤íŠ¸ ë§ˆì»¤
                        const textMarker = new win.naver.maps.Marker({
                            position: position,
                            map: win.AppState.map,
                            icon: {
                                content: '<div style="font-size: 24px; color: #ff0000; font-weight: bold; text-shadow: 2px 2px 4px white; z-index: 999999 !important;">ğŸ…¼ SAVED</div>',
                                anchor: new win.naver.maps.Point(30, 12)
                            },
                            zIndex: 999999
                        });
                        
                        log('ğŸ…¼ ë°©ë²• 2: í…ìŠ¤íŠ¸ ë§ˆì»¤ ìƒì„±', 'success');
                        
                        setTimeout(() => {
                            textMarker.setMap(null);
                            
                            // ë°©ë²• 3: ë„¤ì´ë²„ ê¸°ë³¸ ì•„ì´ì½˜
                            const basicMarker = new win.naver.maps.Marker({
                                position: position,
                                map: win.AppState.map,
                                icon: {
                                    url: 'data:image/svg+xml;base64,' + btoa('<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" fill="#ff0000" stroke="#ffffff" stroke-width="2"/><text x="12" y="16" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="#ffffff">M</text></svg>'),
                                    scaledSize: new win.naver.maps.Size(24, 24),
                                    anchor: new win.naver.maps.Point(12, 12)
                                },
                                zIndex: 999999
                            });
                            
                            log('ğŸ“ ë°©ë²• 3: SVG ì•„ì´ì½˜ ë§ˆì»¤ ìƒì„±', 'success');
                            
                            setTimeout(() => {
                                basicMarker.setMap(null);
                                log('âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ ë§ˆì»¤ ì œê±° ì™„ë£Œ', 'info');
                            }, 5000);
                            
                        }, 5000);
                    }, 5000);
                    
                } catch (error) {
                    log(`âŒ ê°•ì œ ê°€ì‹œì„± ë§ˆì»¤ ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }, 1000);
        }
        
        function step4_ultimateMarkerTest() {
            log('ğŸ”¥ 4ë‹¨ê³„: ê¶ê·¹ ë§ˆì»¤ í…ŒìŠ¤íŠ¸ - ì‹¤ì œ ì €ì¥ ê³¼ì • ì‹œë®¬ë ˆì´ì…˜', 'warning');
            
            const win = getMainWindow();
            if (!win) return;
            
            setTimeout(() => {
                try {
                    if (!win.AppState?.clickParcels?.size) {
                        log('âŒ í´ë¦­ëœ í•„ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!', 'error');
                        return;
                    }
                    
                    // ì‹¤ì œ ì €ì¥ ê³¼ì • ì‹œë®¬ë ˆì´ì…˜
                    const parcels = Array.from(win.AppState.clickParcels.entries());
                    const [pnu, parcelData] = parcels[0];
                    
                    log(`ğŸ¯ ì‹¤ì œ ì €ì¥ ê³¼ì • í…ŒìŠ¤íŠ¸: ${pnu}`, 'info');
                    
                    // í•„ì§€ ì •ë³´ ì„¤ì • (ì €ì¥ëœ ê²ƒì²˜ëŸ¼)
                    parcelData.data.owner = 'ULTRATHINK í…ŒìŠ¤íŠ¸';
                    parcelData.data.memo = 'M ë§ˆì»¤ í…ŒìŠ¤íŠ¸';
                    parcelData.data.isSaved = true;
                    parcelData.hasMarker = true;
                    
                    log('ğŸ“ í•„ì§€ ì •ë³´ ì„¤ì • ì™„ë£Œ', 'success');
                    
                    // ê¸°ì¡´ ë§ˆì»¤ ì œê±° (ìˆë‹¤ë©´)
                    if (parcelData.marker) {
                        parcelData.marker.setMap(null);
                        log('ğŸ—‘ï¸ ê¸°ì¡´ ë§ˆì»¤ ì œê±°', 'info');
                    }
                    
                    // createMMarker í•¨ìˆ˜ ì§ì ‘ í˜¸ì¶œ
                    if (typeof win.createMMarker === 'function') {
                        log('ğŸ¯ createMMarker í•¨ìˆ˜ í˜¸ì¶œ', 'warning');
                        win.createMMarker(pnu);
                        
                        // ê²°ê³¼ í™•ì¸
                        setTimeout(() => {
                            const updatedData = win.AppState.clickParcels.get(pnu);
                            const hasMarker = !!updatedData.marker;
                            const isVisible = hasMarker ? updatedData.marker.getMap() !== null : false;
                            
                            log(`âœ… createMMarker ê²°ê³¼: marker=${hasMarker}, visible=${isVisible}`, hasMarker && isVisible ? 'success' : 'error');
                            
                            if (!hasMarker || !isVisible) {
                                // ìˆ˜ë™ìœ¼ë¡œ ë§ˆì»¤ ìƒì„±
                                log('ğŸ”§ ìˆ˜ë™ ë§ˆì»¤ ìƒì„± ì‹œë„', 'warning');
                                step4_manualMarkerCreation(win, pnu, parcelData);
                            }
                            
                        }, 1000);
                        
                    } else {
                        log('âŒ createMMarker í•¨ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
                        step4_manualMarkerCreation(win, pnu, parcelData);
                    }
                    
                } catch (error) {
                    log(`âŒ ê¶ê·¹ ë§ˆì»¤ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }, 1000);
        }
        
        function step4_manualMarkerCreation(win, pnu, parcelData) {
            try {
                log('ğŸ”§ ìˆ˜ë™ M ë§ˆì»¤ ìƒì„±', 'warning');
                
                const geometry = parcelData.data?.geometry;
                if (!geometry) {
                    log('âŒ ì§€ì˜¤ë©”íŠ¸ë¦¬ ì—†ìŒ', 'error');
                    return;
                }
                
                const coords = geometry.coordinates[0];
                let centerLat = 0, centerLng = 0;
                coords.forEach(coord => {
                    centerLat += coord[1];
                    centerLng += coord[0];
                });
                centerLat /= coords.length;
                centerLng /= coords.length;
                
                log(`ğŸ“ ê³„ì‚°ëœ ì¤‘ì‹¬ì : ${centerLat}, ${centerLng}`, 'info');
                
                // ìˆ˜ë™ ë§ˆì»¤ ìƒì„± (app-core.jsì™€ ë™ì¼í•œ ë°©ì‹)
                const marker = new win.naver.maps.Marker({
                    position: new win.naver.maps.LatLng(centerLat, centerLng),
                    map: win.AppState.map,
                    icon: {
                        content: '<div style="background: #dc3545; color: white; width: 24px; height: 24px; border-radius: 50%; text-align: center; line-height: 24px; font-weight: bold; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); z-index: 1000; cursor: pointer;">M</div>',
                        anchor: new win.naver.maps.Point(12, 12)
                    },
                    zIndex: 1000
                });
                
                // AppStateì— ì €ì¥
                parcelData.marker = marker;
                parcelData.memoMarker = marker;
                parcelData.hasMarker = true;
                
                // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                win.naver.maps.Event.addListener(marker, 'click', function() {
                    log(`ğŸ“ M ë§ˆì»¤ í´ë¦­ë¨: ${pnu}`, 'success');
                    alert(`M ë§ˆì»¤ í´ë¦­ë¨!\\ní•„ì§€: ${parcelData.data?.jibun}\\nì†Œìœ ì: ${parcelData.data?.owner}`);
                });
                
                log('âœ… ìˆ˜ë™ M ë§ˆì»¤ ìƒì„± ì™„ë£Œ!', 'success');
                log('ğŸ‘€ ë§ˆì»¤ê°€ ë³´ì´ëŠ”ì§€ í™•ì¸í•˜ê³  í´ë¦­í•´ë³´ì„¸ìš”', 'info');
                
                // 30ì´ˆ í›„ ì œê±° (í…ŒìŠ¤íŠ¸ìš©)
                setTimeout(() => {
                    if (confirm('í…ŒìŠ¤íŠ¸ ë§ˆì»¤ë¥¼ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        marker.setMap(null);
                        parcelData.marker = null;
                        parcelData.memoMarker = null;
                        parcelData.hasMarker = false;
                        log('ğŸ—‘ï¸ í…ŒìŠ¤íŠ¸ ë§ˆì»¤ ì œê±°ë¨', 'info');
                    }
                }, 30000);
                
            } catch (error) {
                log(`âŒ ìˆ˜ë™ ë§ˆì»¤ ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                log(`ìŠ¤íƒ: ${error.stack}`, 'error');
            }
        }
        
        function step5_realTimeMonitor() {
            if (monitorInterval) {
                clearInterval(monitorInterval);
                monitorInterval = null;
                log('â¹ï¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€', 'info');
                return;
            }
            
            log('ğŸ”¥ 5ë‹¨ê³„: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œì‘', 'warning');
            
            const win = getMainWindow();
            if (!win) return;
            
            monitorInterval = setInterval(() => {
                try {
                    if (!win || win.closed || !win.AppState) {
                        clearInterval(monitorInterval);
                        monitorInterval = null;
                        log('âŒ ëª¨ë‹ˆí„°ë§ ì¤‘ë‹¨: ë©”ì¸ ì°½ ì—†ìŒ', 'error');
                        return;
                    }
                    
                    const parcels = Array.from(win.AppState.clickParcels.entries());
                    const savedParcels = parcels.filter(([, data]) => data.data?.isSaved);
                    const markersWithFlag = parcels.filter(([, data]) => data.hasMarker);
                    const markersWithObject = parcels.filter(([, data]) => data.marker);
                    const visibleMarkers = parcels.filter(([, data]) => data.marker && data.marker.getMap() !== null);
                    
                    // DOM ë§ˆì»¤ ìš”ì†Œ í™•ì¸
                    const domMarkers = win.document.querySelectorAll('[style*="M"],[title*="M"]').length;
                    const naverMarkers = win.document.querySelectorAll('.naver-marker').length;
                    
                    log(`ğŸ“Š ì‹¤ì‹œê°„ ìƒíƒœ: í•„ì§€${parcels.length} | ì €ì¥ë¨${savedParcels.length} | hasMarker${markersWithFlag.length} | markerê°ì²´${markersWithObject.length} | í‘œì‹œë¨${visibleMarkers.length} | DOM${domMarkers} | ë„¤ì´ë²„ë§ˆì»¤${naverMarkers}`, 'info');
                    
                } catch (error) {
                    log(`âŒ ëª¨ë‹ˆí„°ë§ ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            }, 3000);
            
            log('âœ… ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œì‘ë¨ (3ì´ˆ ê°„ê²©)', 'success');
        }
        
        // ì´ˆê¸°í™”
        log('ğŸ”¥ ULTRATHINK M ë§ˆì»¤ í•´ê²° ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ!', 'success');
        log('ğŸ“‹ ìˆœì„œëŒ€ë¡œ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì§„ë‹¨í•˜ì„¸ìš”:', 'info');
        log('  1ï¸âƒ£ ê¸°ë³¸ ë§ˆì»¤ í…ŒìŠ¤íŠ¸ â†’ 2ï¸âƒ£ ì¢Œí‘œ ê²€ì¦ â†’ 3ï¸âƒ£ ê°•ì œ ë§ˆì»¤ â†’ 4ï¸âƒ£ ê¶ê·¹ í…ŒìŠ¤íŠ¸', 'info');
        log('', 'info');
        log('âš ï¸ ë¨¼ì € ë©”ì¸ í˜ì´ì§€ì—ì„œ í•„ì§€ë¥¼ í´ë¦­í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ˆì„¸ìš”!', 'warning');
        
    </script>
</body>
</html>